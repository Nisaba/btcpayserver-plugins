@using BTCPayServer.Abstractions.Extensions
@using BTCPayServer.Plugins.Shopstr.Views

@model BTCPayServer.Plugins.Shopstr.Models.ShopstrViewModel
@{
    ViewData.SetActivePage(PluginNavPages.Index, "Shopstr plugin");
    bool bNostr;
    bool bApp;
}

<table>
    <tr>
        <td>
            <a href="https://shopstr.market/">
                <img src="/Resources/img/Shopstr.webp" />
            </a>
        </td>
        <td width="20" />
        <td>
            <p>
                Shopstr plugin<br />
                Please read our documentation <a href="https://github.com/Nisaba/btcpayserver-plugins/blob/master/BTCPayServer.Plugins.Shopstr/README.md" target="_blank">here</a>.
            </p>
        </td>
    </tr>
</table>
<br />
@if (Model.Nip5Settings == null || !Model.Nip5Settings.IsConfigured)
{
    <div class="alert alert-warning d-flex align-items-center" role="alert">
        <span class="me-2"><i class="fa fa-exclamation-triangle"></i></span>
        Your Nostr plugin is not configured yet.
        <a href="/stores/@Model.storeId/plugins/nip5" class="alert-link ms-2">Configure now</a>
    </div>
    bNostr = false;
}
else
{
    <div class="card mb-3">
        <div class="card-header">
            <strong>Nostr Configuration</strong>
        </div>
        <div class="card-body">
            <div class="mb-2">
                <span class="badge bg-success me-2">Pubkey</span>
                <span class="badge badge-expired">@Model.Nip5Settings.PubKey</span>
            </div>
            <div>
                <span class="badge bg-info me-2">Relays</span>
                <span>
                    @foreach (var rel in Model.Nip5Settings.Relays)
                    {
                        <span class="badge badge-expired">
                            @rel
                        </span>
                    }
                </span>
            </div>
        </div>
    </div>
    bNostr = true;
}
@if (Model.StoreApps.Count == 0)
{
    <div class="alert alert-info d-flex align-items-center" role="alert">
        <span class="me-2"><i class="fa fa-info-circle"></i></span>
        You do not have any Shop apps in your BTCPay store yet.
        <a href="/stores/@Model.storeId/apps/create/PointOfSale" class="alert-link ms-2">Create an app</a>
    </div>
    bApp = false;
}
else
{
    <div class="alert alert-success d-flex align-items-center" role="alert">
        <span class="me-2"><i class="fa fa-check-circle"></i></span>
        @Model.StoreApps.Count Shop app(s) ready to be synchronized in this store.
    </div>
    bApp = true;
}
@if (bNostr && bApp)
{
    <br />
    <p>You are all set! You can now start selling your products on Shopstr. Go to <a href="https://shopstr.market/" target="_blank">Shopstr Market</a> and connect your BTCPay store using your Nostr pubkey.</p>
    <table class="table table-hover">
        <thead>
            <tr>
                <th>App Name</th>
                <th>To Add</th>
                <th>To Update</th>
                <th>To Remove</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var app in Model.StoreApps)
            {
                var lstAppSentItemsToShopstr = Model.SentItemsToShopstr.Where(o => o.AppId == app.Id).ToList();
                app.GetListItemsToSync(lstAppSentItemsToShopstr);
                <tr>
                    <td>@app.Name</td>
                    <td>@app.ItemsToAdd.Count</td>
                    <td>@app.ItemsToUpdate.Count</td>
                    <td>@app.ItemsToRemove.Count</td>
                    <td></td>
                </tr>
            }
        </tbody>
    </table>
}